name: Novel Crawler Debug

on:
  workflow_dispatch:
    inputs:
      query:
        description: 'Novel to search'
        required: true
        default: 'æ–—ç ´è‹ç©¹'

jobs:
  debug:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Verify files
      run: |
        echo "ğŸ“ Repository contents:"
        ls -la
        echo "ğŸ“œ First lines of crawler:"
        head -n 30 piaotian_crawler.py

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-dev python3-pip
        pip install --upgrade pip wheel
        pip install requests beautifulsoup4 urllib3
        pip install git+https://github.com/dipu-bd/lightnovel-crawler.git@master

    - name: Run crawler with test query
      run: |
        echo "ğŸŸ¢ Python path: $(which python)"
        echo "ğŸŸ¢ Python version: $(python --version)"
        python piaotian_crawler.py "${{ inputs.query }}" || echo "âŒ Script failed with exit code $?"

    - name: Show results
      if: always()
      run: |
        echo "ğŸ“‚ Result files:"
        ls -la results/ || echo "No results directory"
        cat results/*.json || echo "No result files"
